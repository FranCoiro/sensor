// Reemplaza la función de manejo del archivo en tu index.html
fileInput.addEventListener('change', async (event) => {
    if (!event.target.files.length) return;
    
    try {
        loadingDiv.style.display = 'block';
        errorDiv.style.display = 'none';
        reportDiv.style.display = 'none';

        const file = event.target.files[0];
        if (!file.name.toLowerCase().endsWith('.csv')) {
            throw new Error('Por favor selecciona un archivo CSV válido');
        }

        const formData = new FormData();
        formData.append('csvFile', file);

        const response = await fetch('/api', {
            method: 'POST',
            body: formData
        });

        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            throw new Error('Error en el servidor: respuesta no válida');
        }

        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.error || 'Error al procesar el archivo');
        }

        // Mostrar resultados
        document.getElementById('sensorType').textContent = 
            data.sensorType === 'temperatura' ? 'Temperatura' : 'Humedad';
        document.getElementById('totalData').textContent = data.totalReadings;
        document.getElementById('totalErrors').textContent = data.errors;
        document.getElementById('errorRate').textContent = data.errorRate;
        
        reportDiv.style.display = 'block';
    } catch (error) {
        console.error('Error:', error);
        errorDiv.textContent = error.message;
        errorDiv.style.display = 'block';
    } finally {
        loadingDiv.style.display = 'none';
    }
});
